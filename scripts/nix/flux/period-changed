#!/usr/bin/env bash

wal_setup() {
  if [[ ! -x $(command -v wal) ]]; then
    echo "wal: not executable"
    return 1
  fi

  local period=$1
  local theme="base16-google -l"
  echo "wal: period: $period"

  case $period in
  night)
    theme="base16-gruvbox-hard"
    ;;
  transition)
    theme="solarized -l"
    ;;
  esac

  wal --theme $theme
}

neovim_setup() {
  local period=$1
  local key="<c-\><c-n> tcd"
  echo "neovim: period: $period"
  case $period in
  night)
    key="<c-\><c-n> tcn"
    ;;
  transition)
    key="<c-\><c-n> tct"
    ;;
  esac
  for s in ${XDG_RUNTIME_DIR:-${TMPDIR}nvim.${USER}}/nvim.*.0; do
    [[ -S "$s" ]] && nvim --server "$s" --remote-send "$key"
  done
  if [[ -S /tmp/nvim_journal.socket ]]; then
    nvim --server /tmp/nvim_journal.socket --remote-send "$key"
  fi
}

gtk_setup() {
  if [[ ! -x $(command -v gsettings) ]]; then
    echo "gtk: gsettings not executable"
    return 1
  fi

  local period=$1
  local theme="Adapta"
  local icons="Papirus"

  echo "gtk: period: $period"
  case $period in
  night)
    theme="Adapta-Nokto"
    ;;
  esac

  gsettings set org.gnome.desktop.interface gtk-theme "$theme"
  gsettings set org.gnome.desktop.interface icon-theme "$icons"
  gsettings set org.gnome.desktop.interface color-scheme "$([ "$period" = "night" ] && echo "prefer-dark" || echo "prefer-light")"
}


# Execute setups in the right order
wal_setup "$1" # Run wal first to generate colors
neovim_setup "$1"
gtk_setup "$1"

# Send notification
notify-send "period-changed" "Configuration '$1' applied with pywal!" -t 3000
